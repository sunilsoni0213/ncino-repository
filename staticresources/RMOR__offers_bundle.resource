!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(module,exports,__webpack_require__){module.exports=__webpack_require__(1)},function(module,exports,__webpack_require__){__webpack_require__(2),__webpack_require__(3),__webpack_require__(4),__webpack_require__(6),__webpack_require__(8),__webpack_require__(10)},function(module,exports){!function(){"use strict";angular.module("ncOffers",["ncDataProviders","ncUI","ncPubsub","ncNavigator"])}()},function(module,exports){!function(){"use strict";angular.element(document).ready(function(){angular.bootstrap(document.getElementById("ncOffers"),["ncOffers"])})}()},function(module,exports,__webpack_require__){!function(){"use strict";angular.module("ncOffers").component("offers",{controllerAs:"vm",controller:["$scope","config","label","ui","pubsub","navigator","messageService","offersService",function($scope,config,label,ui,pubsub,navigator,messageService,offersService){var vm=this;function resetScorecard(scorecardsDto){0<scorecardsDto.records.length&&(vm.scorecard=scorecardsDto.records[0],vm.scorecard.attributes.LLC_BI__Description__c&&(vm.reason=vm.scorecard.attributes.LLC_BI__Description__c))}vm.config=config.get(),vm.noOffersImageSrc=vm.config.noOffersImageSrc,vm.labels=label.getLabels(),vm.pubsub=pubsub,vm.navigator=navigator,vm.messageService=messageService,vm.loaded=!1,vm.offers=[],vm.collapsedCardMetadata=[],vm.expandedCardMetadata=[],vm.loadedCardMetadata=!1,vm.reason=null,vm.scorecard=null,vm.loanAmount=vm.config.loanAmount,vm.offerSorting=vm.config.defaultOfferSorting,vm.offerSortingOptions=vm.config.offerSortingOptions,vm.displayRecalculateOffers=vm.config.recalculateOffersFieldSet&&0<vm.config.recalculateOffersFieldSet.length,vm.offersFieldSets=[vm.config.collapsedOfferCardFieldSet,vm.config.expandedOfferCardFieldSet],vm.$onInit=function(){vm.displayTopBarComponents(),offersService.retrieveOffers().then(function(offersDto){if(vm.offers=offersDto.records,0===vm.offers.length)offersService.retrieveScorecard().then(function(scorecardsDto){resetScorecard(scorecardsDto),vm.loaded=!0});else{var fieldSetPayload={filters:{identities:vm.offersFieldSets,contextType:vm.config.constants.PRICING_OPTION_CONTEXT_TYPE}};offersService.loadFieldSetMetadata(fieldSetPayload).then(function(metadata){vm.collapsedCardMetadata=metadata.fieldSetMetadataMap[vm.config.collapsedOfferCardFieldSet],vm.expandedCardMetadata=metadata.fieldSetMetadataMap[vm.config.expandedOfferCardFieldSet],vm.loadedCardMetadata=!0}),vm.setContinueButtonActive(Boolean(offersService.getSelectedOffer())),vm.loaded=!0}})},vm.displayTopBarComponents=function(){vm.pubsub.publish(vm.pubsub.topics.ANCHOR_SET,{link:vm.config.topBarLink,text:vm.config.topBarText,src:vm.config.topBarIcon,background:vm.config.topBarIconBackgroud}),vm.pubsub.publish(vm.pubsub.topics.PRIMARY_BUTTON_SET,{rendered:!0,disabled:!0,text:vm.labels.Continue.toLowerCase(),styleClass:"offers-continue slds-button slds-button_neutral",onClick:function(){offersService.getSelectedOffer()?vm.navigateToNextUrl():(vm.messageService.setMessage({canDismiss:!0,type:vm.messageService.messageTypes.error,text:vm.labels.No_Offer_Selected_Message},!0),$scope.$apply())}})},vm.navigateToNextUrl=function(){var nextHref=vm.config.nextHref;nextHref?vm.navigator.navigateToRoute(nextHref):navigator.isSF1App()?vm.navigator.navigateToURL("/home/home.jsp",!0):vm.navigator.navigateToSObject(vm.config.contextId,null)},vm.hydrateNumberLabel=function(label,number){return label.replace("{#}",number)},vm.formatCurrency=function(number){return LifeCycle.Internationalize.format(number,LifeCycle.Internationalize.formats.numeric.CURRENCY)},vm.getOfferSortingField=function(offer){return parseFloat(offer.attributes[vm.offerSorting])},vm.setContinueButtonActive=function(enabled){pubsub.publish(vm.config.constants.PRIMARY_BUTTON_SET,{disabled:!enabled})},vm.displayErrorMessage=function(error){vm.messageService.setMessage({type:vm.messageService.messageTypes.error,text:error,canDismiss:!0},!0)},vm.setSelectedOfferAndBlockUI=function(offer){offer&&ui.block(),offersService.setSelectedOffer(offer).then(function(){vm.setContinueButtonActive(Boolean(offer))}).catch(function(error){vm.displayErrorMessage(error)}).finally(function(){offer&&ui.unblock()})},$scope.$on("offerSelected",function(event,offer){vm.setSelectedOfferAndBlockUI(offer)}),pubsub.subscribe(vm.config.constants.NEW_OFFERS_LOADED,function(offersDto){vm.offers=offersDto.records}),pubsub.subscribe(vm.config.constants.NEW_SCORECARD_LOADED,resetScorecard),pubsub.subscribe(vm.config.constants.NEW_LOAN_AMOUNT_LOADED,function(loanAmount){vm.loanAmount=loanAmount})}],template:__webpack_require__(5)})}()},function(module,exports){module.exports='<div class="slds-grid slds-grid_vertical">\n  \x3c!-- Message Service Toast --\x3e\n  <div class="slds-col slds-gutters_x-small">\n    <message />\n  </div>\n  \x3c!-- Recalculate Offers Container (visible on mobile) --\x3e\n  <div ng-if="vm.loaded && vm.displayRecalculateOffers" class="slds-col slds-size_1-of-1 slds-hide_medium">\n    <recalculate-offers></recalculate-offers>\n  </div>\n\n  \x3c!-- Offers Page Main Container --\x3e\n  <div class="slds-col slds-grid slds-gutters">\n    \x3c!-- Offers List Container --\x3e\n    <div\n      class="slds-col"\n      ng-class="{ \'slds-size_1-of-1 slds-medium-size_3-of-4\': vm.displayRecalculateOffers, \'slds-size_1-of-1\': !vm.displayRecalculateOffers }"\n    >\n      <div class="slds-box slds-theme_default">\n        \x3c!-- No Offers Container --\x3e\n        <div\n          ng-if="vm.loaded && vm.offers.length === 0"\n          class="slds-text-align_center slds-m-vertical_large"\n        >\n          <img ng-src="{{::vm.noOffersImageSrc}}" class="slds-p-bottom_medium" />\n          <div class="slds-text-heading_medium">\n            {{ vm.labels.No_Offers_Returned_Message }}\n          </div>\n          <div ng-if="vm.reason" class="slds-text-body_small slds-text-color_weak">\n            {{ vm.reason }}\n          </div>\n        </div>\n        \x3c!-- Returned Offers Container --\x3e\n        <div ng-if="vm.loaded && vm.offers.length > 0">\n          \x3c!-- Offers List Header --\x3e\n          <div class="slds-text-heading_large slds-m-vertical_small">\n            {{\n              vm.hydrateNumberLabel(vm.labels.Requested_Loan_Amount, vm.formatCurrency(vm.loanAmount))\n            }}\n          </div>\n          \x3c!-- Offers Sorting Section --\x3e\n          <div class="slds-text-title slds-m-bottom_large">\n            {{ vm.hydrateNumberLabel(vm.labels.Offers_Returned, vm.offers.length) }}\n            <label>\n              &bull;\n              {{ vm.labels.Offers_Sorting_Preference }}\n              <span ng-if="vm.offerSortingOptions.length === 1">\n                {{ vm.offerSortingOptions[0].label }}\n              </span>\n              <span\n                ng-if="vm.offerSortingOptions.length > 1"\n                class="slds-select_container rmor-sorting-select"\n              >\n                <select ng-model="vm.offerSorting" class="slds-select">\n                  <option\n                    ng-repeat="sortingOption in vm.offerSortingOptions"\n                    ng-value="sortingOption.field"\n                  >\n                    {{ sortingOption.label }}\n                  </option>\n                </select>\n              </span>\n            </label>\n          </div>\n          \x3c!-- Offers Card List --\x3e\n          <offers-card\n            ng-show="vm.offers.length > 0"\n            ng-repeat="offer in vm.offers | orderBy: vm.getOfferSortingField track by offer.identity"\n            offer="offer"\n            collapsed-card-metadata="vm.collapsedCardMetadata"\n            expanded-card-metadata="vm.expandedCardMetadata"\n            ng-if="vm.loadedCardMetadata"\n          ></offers-card>\n        </div>\n      </div>\n    </div>\n    \x3c!-- Recalculate Offers Container (visible > 768px) --\x3e\n    <div ng-if="vm.loaded && vm.displayRecalculateOffers" class="slds-col slds-show_medium slds-medium-size_1-of-4">\n      <recalculate-offers></recalculate-offers>\n    </div>\n  </div>\n</div>'},function(module,exports,__webpack_require__){!function(){"use strict";angular.module("ncOffers").component("offersCard",{bindings:{offer:"=",collapsedCardMetadata:"<",expandedCardMetadata:"<"},controllerAs:"vm",controller:["$scope","config","label","offersService",function($scope,config,label,offersService){var vm=this;vm.config=config.get(),vm.labels=label.getLabels(),vm.loaded=!1,vm.showContent=!1,vm.$onInit=function(){vm.loaded=!0},vm.toggleExpansion=function(){vm.showContent=vm.isDisabled()===vm.showContent},vm.changeSelectedState=function(state){vm.offer.isSelected=state,$scope.$emit("offerSelected",state?vm.offer:null)},vm.isDisabled=function(){return null!=offersService.getSelectedOffer()&&!vm.offer.isSelected},vm.getCardDisabledClasses=function(){return vm.isDisabled()?"offer-card-disabled":""},vm.getCardExpandedClasses=function(){return vm.showContent?"slds-is-open offer-border-expanded":""},vm.getIconClasses=function(){return"slds-section__title-action-icon"+(vm.isDisabled()?" action-icon-disabled":"")}}],template:__webpack_require__(7)})}()},function(module,exports){module.exports='<div\n  class="slds-section slds-box slds-p-around_medium offer-border"\n  ng-class="[vm.getCardDisabledClasses(), vm.getCardExpandedClasses()]"\n>\n  <div class="slds-section__title slds-grid slds-gutters slds-wrap">\n    <div class="slds-col slds-size_1-of-12 slds-align-middle">\n      <nds-icon\n        aria-controls="{{ vm.offer.identity }}-offer-card"\n        aria-expanded="{{ vm.showContent }}"\n        ng-click="vm.toggleExpansion()"\n        icon-type="utility"\n        icon-name="switch"\n        fill="{{ ::vm.config.theme.brandDark }}"\n        span-class="{{ vm.getIconClasses() }}"\n        svg-class="slds-icon_small"\n      ></nds-icon>\n    </div>\n    <div class="slds-col slds-size_11-of-12 slds-large-size_2-of-12 slds-align-middle">\n      <span class="offer-name" ng-bind="vm.offer.attributes.Name"></span>\n    </div>\n    <div class="slds-col slds-size_12-of-12 slds-large-size_7-of-12 slds-align-middle slds-p-vertical_medium">\n      <nds-form\n        id="{{ vm.offer.identity }}-collapsed-card"\n        class="collapsed-offer-card"\n        is-editable="false"\n        form-entity="{{ vm.offer }}"\n        form-metadata="{{ vm.collapsedCardMetadata }}"\n        columns="{{ ::vm.collapsedCardMetadata.length }}"\n        ng-if="vm.loaded"\n        mobile-columns="{{ ::vm.collapsedCardMetadata.length }}"\n      ></nds-form>\n    </div>\n    <div class="slds-col slds-size_12-of-12 slds-large-size_2-of-12 slds-align-middle offers-card-select-btn">\n      <nds-button\n        id="{{ vm.offer.identity }}-select"\n        button-class=""\n        ng-if="vm.loaded"\n        theme="{{ vm.offer.isSelected ? \'brand\' : \'neutral\' }}"\n        state="{{ ::vm.offer.isSelected }}"\n        ng-disabled="vm.isDisabled()"\n        ng-on-button_click="vm.changeSelectedState($event.originalEvent.detail)"\n      >\n        <span class="slds-text-not-pressed" ng-bind="vm.labels.Select_Offer"></span>\n        <span class="slds-text-pressed" ng-bind="vm.labels.Offer_Selected"></span>\n      </nds-button>\n    </div>\n  </div>\n  <div aria-hidden="{{ !vm.showContent }}" class="slds-section__content" id="{{ vm.offer.identity }}-offer-card">\n    <hr class="slds-m-vertical_xx-small offer-card-divider" />\n    <nds-form\n      id="{{ vm.offer.identity }}-expanded-card"\n      class="expanded-offer-card"\n      is-editable="false"\n      form-entity="{{ vm.offer }}"\n      form-metadata="{{ ::vm.expandedCardMetadata }}"\n      columns="{{ ::vm.expandedCardMetadata.length }}"\n      ng-if="vm.loaded"\n    >\n    </nds-form>\n  </div>\n</div>\n'},function(module,exports,__webpack_require__){!function(){"use strict";angular.module("ncOffers").component("recalculateOffers",{controllerAs:"vm",controller:["$scope","config","label","ui","messageService","offersService",function($scope,config,label,ui,messageService,offersService){var vm=this;vm.config=config.get(),vm.labels=label.getLabels(),vm.recalculateOfferFormChanged=!1,vm.loaded=!1,vm.fieldSetName=vm.config.recalculateOffersFieldSet,vm.fieldSetContextType=vm.config.constants.RECALCULATE_OFFERS_CONTEXT_TYPE,vm.form={entity:{},metadata:[]},vm.$onInit=function(){if(vm.fieldSetName){var fieldSetPayload={filters:{identities:[vm.fieldSetName],contextType:vm.fieldSetContextType}};offersService.loadFieldSetMetadata(fieldSetPayload).then(function(metadata){vm.form.metadata=metadata.fieldSetMetadataMap[vm.fieldSetName],offersService.retrieveMortgage().then(function(mortgagesDto){0<mortgagesDto.records.length&&(vm.form.entity=mortgagesDto.records[0]),vm.loaded=!0})})}},vm.recalculateOffers=function(){ui.block(),offersService.recalculateOffers({records:[vm.form.entity]}).then(function(){vm.recalculateOfferFormChanged=!1}).catch(function(){messageService.setMessage({canDismiss:!0,type:messageService.messageTypes.error,text:vm.labels.Recalculate_Failed},!0),$scope.$apply()}).finally(ui.unblock)},vm.handleFormChange=function($event){var data=$event.originalEvent.detail;vm.form.entity.attributes[data.fieldPath]=data.value}}],template:__webpack_require__(9)})}()},function(module,exports){module.exports='<div ng-if="vm.loaded" class="slds-box slds-theme_default">\n  <div class="slds-text-heading_small slds-m-bottom_small">\n    {{ ::vm.labels.Recalculate_Offers }}\n  </div>\n  <div class="slds-m-bottom_medium">\n    <nds-form\n      id="recalculate-offers-form"\n      is-editable="true"\n      form-entity="{{ ::vm.form.entity }}"\n      form-metadata="{{ vm.form.metadata }}"\n      columns="1"\n      ng-on-form_value_change="vm.handleFormChange($event)"\n      ng-on-keyup="vm.recalculateOfferFormChanged = true"\n    ></nds-form>\n  </div>\n  <nds-button \n    theme="neutral"\n    ng-disabled="!vm.recalculateOfferFormChanged"\n    ng-click="vm.recalculateOffers()">\n    {{ ::vm.labels.Recalculate_Offers_Button }}\n  </nds-button>\n</div>\n'},function(module,exports){!function(){"use strict";angular.module("ncOffers").service("offersService",["config","$q","remotingManager","pubsub",function OffersService(config,$q,remotingManager,pubsub){var service=this,configData=config.get(),selectedOffer=null,selectedOfferId=configData.selectedOfferId||null;function runAutoDecision(){return invokeRemoteAction(configData.endpoints.runAutoDecision,{loanId:configData.contextId})}function retrieveOffers(){return $q(function(resolve,reject){invokeRemoteAction(configData.endpoints.retrieveOffers,{args:JSON.stringify({loanId:configData.contextId,fieldSetNames:[configData.collapsedOfferCardFieldSet,configData.expandedOfferCardFieldSet]})}).then(function(offersDto){var offersRecords=offersDto.records;selectedOffer=null,selectedOfferId&&(selectedOffer=offersRecords.find(function(offerRecord){return selectedOfferId===offerRecord.identity}))&&(selectedOffer.isSelected=!0),resolve(offersDto)}).catch(reject)})}function retrieveScorecard(){return invokeRemoteAction(configData.endpoints.retrieveScorecard,{loanId:configData.contextId})}function generateNewOffers(){return invokeRemoteAction(configData.endpoints.generateNewOffers,{loanId:configData.contextId})}function calculateOffersDTI(){return invokeRemoteAction(configData.endpoints.calculateOffersDTI,{loanId:configData.contextId})}function filterOffersByDTI(){return invokeRemoteAction(configData.endpoints.filterOffersByDTI,{loanId:configData.contextId})}function calculateAllOffers(offerIds){var promises=offerIds.map(function(offerId){return invokeRemoteAction(configData.endpoints.calculateOffer,{offerId:offerId})});return $q.all(promises)}function updateScorecard(offers){var deferred=$q.defer();return 0===offers.records.length?retrieveScorecard().then(function(scorecardsDto){!function resetScorecard(scorecardsDto){pubsub.publish(configData.constants.NEW_SCORECARD_LOADED,scorecardsDto)}(scorecardsDto),deferred.resolve(offers)}):deferred.resolve(offers),deferred.promise}function resetOffers(offers){var deferred=$q.defer();return service.setSelectedOffer(null),pubsub.publish(configData.constants.NEW_OFFERS_LOADED,offers),deferred.resolve()}function retrieveLoanAmount(){return invokeRemoteAction(configData.endpoints.retrieveLoanAmount,{loanId:configData.contextId})}function resetLoanAmount(loanAmount){var deferred=$q.defer();return pubsub.publish(configData.constants.NEW_LOAN_AMOUNT_LOADED,loanAmount),deferred.resolve()}function invokeRemoteAction(endpointAction,endpointParams){var deferred=$q.defer();return remotingManager.invokeAction(configData.endpoints.remoteActionInvoke,endpointAction,endpointParams,function(results,event){event.status?deferred.resolve(results):deferred.reject(event.message)},{escape:!1,buffer:!1}),deferred.promise}service.runAutoDecision=runAutoDecision,service.retrieveOffers=retrieveOffers,service.retrieveScorecard=retrieveScorecard,service.retrieveMortgage=function(){return invokeRemoteAction(configData.endpoints.retrieveMortgage,{loanId:configData.contextId,fieldSetName:configData.recalculateOffersFieldSet})},service.recalculateOffers=function(mortgagesDto){return function updateLoanRecords(mortgagesDto){return invokeRemoteAction(configData.endpoints.updateLoanRecords,{args:JSON.stringify({mortgagesDto:mortgagesDto,fieldSetName:configData.recalculateOffersFieldSet})})}(mortgagesDto).then(generateNewOffers).then(calculateAllOffers).then(calculateOffersDTI).then(filterOffersByDTI).then(runAutoDecision).then(retrieveOffers).then(updateScorecard).then(resetOffers).then(retrieveLoanAmount).then(resetLoanAmount)},service.loadFieldSetMetadata=function(params){return invokeRemoteAction(configData.endpoints.loadFieldSetMetadata,{args:JSON.stringify(params)})},service.applyOffer=function(params){return invokeRemoteAction(configData.endpoints.applyOffer,{args:JSON.stringify(params)})},service.getSelectedOffer=function(){return selectedOffer},service.setSelectedOffer=function(offer){return $q(function(resolve,reject){if(selectedOfferId=(selectedOffer=offer)?offer.identity:null,selectedOffer){var payload={loanId:configData.contextId,offer:selectedOffer,fieldSetNames:[configData.collapsedOfferCardFieldSet,configData.expandedOfferCardFieldSet]};service.applyOffer(payload).then(resolve,reject)}else resolve()})}}])}()}]);